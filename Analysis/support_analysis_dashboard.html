<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Ticket Analysis Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .stat-value {
            color: #2d3748;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            color: #a0aec0;
            font-size: 13px;
        }

        .alert-badge {
            display: inline-block;
            background: #fc8181;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .success-badge {
            display: inline-block;
            background: #68d391;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            color: #2d3748;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .problem-products {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .problem-products h2 {
            color: #2d3748;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-icon {
            color: #f56565;
            font-size: 28px;
        }

        .product-list {
            display: grid;
            gap: 15px;
        }

        .product-item {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }

        .product-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .product-item.critical {
            border-color: #fc8181;
            background: #fff5f5;
        }

        .product-item.warning {
            border-color: #f6ad55;
            background: #fffaf0;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }

        .severity-badge {
            padding: 6px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-critical {
            background: #fc8181;
            color: white;
        }

        .severity-warning {
            background: #f6ad55;
            color: white;
        }

        .severity-monitor {
            background: #fbd38d;
            color: #744210;
        }

        .product-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .metric {
            display: flex;
            flex-direction: column;
        }

        .metric-label {
            font-size: 12px;
            color: #718096;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
        }

        .metric-value.bad {
            color: #e53e3e;
        }

        .metric-value.warning {
            color: #dd6b20;
        }

        .metric-value.good {
            color: #38a169;
        }

        .issues-list {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .issues-title {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .issue-tag {
            display: inline-block;
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            margin-right: 6px;
            margin-bottom: 6px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 20px;
        }

        .filters {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-label {
            font-weight: 600;
            color: #2d3748;
        }

        select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        select:hover {
            border-color: #667eea;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function Dashboard() {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterCategory, setFilterCategory] = useState('all');
            const [filterPriority, setFilterPriority] = useState('all');

            const ticketsByProductRef = useRef(null);
            const satisfactionByProductRef = useRef(null);
            const categoryBreakdownRef = useRef(null);
            const priorityDistributionRef = useRef(null);
            const resolutionTimeRef = useRef(null);
            const satisfactionTrendRef = useRef(null);

            const chartInstances = useRef({});

            useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                if (data.length > 0) {
                    createCharts();
                }

                return () => {
                    Object.values(chartInstances.current).forEach(chart => {
                        if (chart) chart.destroy();
                    });
                    chartInstances.current = {};
                };
            }, [data, filterCategory, filterPriority]);

            const loadData = () => {
                const csvData = `Ticket_ID,Created_Date,Resolved_Date,Category,Sub_Category,Priority,Status,Customer_Tier,Product,Issue_Description,Resolution_Time_Hours,First_Response_Time_Hours,Customer_Satisfaction,Agent_Name,Resolution_Type,Escalated,Follow_Up_Required,Related_Tickets
T10001,2024-01-15 09:23,2024-01-15 14:45,Technical,Login Issues,High,Resolved,Enterprise,Analytics Suite,Cannot access dashboard after password reset,5.4,0.5,4,John Martinez,Password Reset,No,No,0
T10002,2024-01-15 10:15,2024-01-16 11:30,Billing,Payment Failed,Medium,Resolved,Small Business,Cloud Storage Pro,Credit card declined during renewal,25.3,2.1,5,Emily Chen,Payment Retry,No,No,0
T10003,2024-01-15 11:42,2024-01-15 13:20,Feature Request,Integration,Low,Resolved,Enterprise,CRM System,Request Salesforce integration,1.6,0.3,5,Marcus Brown,Feature Added to Roadmap,No,Yes,0
T10004,2024-01-15 13:05,2024-01-17 09:15,Technical,Performance,Critical,Resolved,Enterprise,Database Pro,Query timeouts on large datasets,44.2,0.2,3,Sarah Kim,Configuration Change,Yes,Yes,2
T10005,2024-01-15 14:28,2024-01-15 16:10,Account,User Management,Medium,Resolved,Small Business,Project Manager,Cannot add new team members,1.7,0.8,4,David Lopez,Permission Fix,No,No,0
T10006,2024-01-16 08:45,2024-01-18 14:20,Technical,Data Loss,Critical,Resolved,Enterprise,Collaboration Tools,Files missing after sync,53.6,0.1,2,Emily Chen,Data Recovery,Yes,Yes,3
T10007,2024-01-16 09:30,2024-01-16 10:45,How-To,Basic Usage,Low,Resolved,Consumer,Email Platform,How to create email templates,1.3,0.4,5,John Martinez,Tutorial Provided,No,No,0
T10008,2024-01-16 11:15,2024-01-16 15:30,Billing,Invoice Request,Low,Resolved,Small Business,Security Suite,Need detailed invoice for accounting,4.3,1.2,5,Marcus Brown,Invoice Sent,No,No,0
T10009,2024-01-16 13:50,2024-01-19 10:25,Technical,Bug Report,High,Resolved,Enterprise,Analytics Suite,Charts not rendering in reports,68.6,0.6,4,Sarah Kim,Bug Fix Deployed,Yes,No,1
T10010,2024-01-16 15:20,2024-01-16 16:05,Account,Access Request,Medium,Resolved,Small Business,Project Manager,Request admin privileges,0.8,0.3,5,David Lopez,Permission Granted,No,No,0
T10011,2024-01-17 08:15,2024-01-17 12:40,Technical,Installation,Medium,Resolved,Enterprise,Database Pro,Installation fails on Linux server,4.4,0.7,4,Emily Chen,Installation Guide,No,Yes,0
T10012,2024-01-17 09:45,2024-01-17 11:20,Feature Request,Export Options,Low,Resolved,Small Business,CRM System,Need CSV export for contacts,1.6,0.5,5,John Martinez,Workaround Provided,No,No,0
T10013,2024-01-17 11:30,2024-01-20 09:15,Technical,Integration,High,Resolved,Enterprise,Marketing Automation,Webhook failures with third-party app,69.8,0.4,3,Marcus Brown,Integration Fixed,Yes,Yes,2
T10014,2024-01-17 14:05,2024-01-17 15:30,Billing,Upgrade Request,Medium,Resolved,Small Business,Cloud Storage Pro,Want to upgrade to enterprise plan,1.4,0.6,5,Sarah Kim,Account Upgraded,No,No,0
T10015,2024-01-17 15:50,2024-01-17 17:25,How-To,Advanced Feature,Low,Resolved,Enterprise,Analytics Suite,How to create custom dashboards,1.6,0.4,4,David Lopez,Documentation Link,No,No,0
T10016,2024-01-18 08:30,2024-01-22 11:45,Technical,Security,Critical,Resolved,Enterprise,Security Suite,Suspicious login attempts detected,99.3,0.1,4,Emily Chen,Security Audit,Yes,Yes,4
T10017,2024-01-18 10:15,2024-01-18 11:50,Account,Profile Update,Low,Resolved,Consumer,Email Platform,Cannot update email preferences,1.6,0.5,5,John Martinez,Profile Updated,No,No,0
T10018,2024-01-18 12:40,2024-01-18 16:20,Technical,Mobile App,Medium,Resolved,Small Business,Project Manager,Mobile app crashing on iOS,3.7,0.9,4,Marcus Brown,App Update Required,No,Yes,0
T10019,2024-01-18 14:15,2024-01-21 10:30,Technical,Data Migration,High,Resolved,Enterprise,Database Pro,Migration from old system failing,68.3,0.3,3,Sarah Kim,Migration Script,Yes,Yes,3
T10020,2024-01-18 16:05,2024-01-18 17:20,Billing,Refund Request,Medium,Resolved,Small Business,Collaboration Tools,Charged twice for subscription,1.3,0.7,5,David Lopez,Refund Processed,No,No,0
T10021,2024-01-19 09:20,2024-01-19 13:45,Technical,Email Delivery,High,Resolved,Small Business,Email Platform,Emails going to spam folder,4.4,0.5,4,Emily Chen,DNS Configuration,No,Yes,1
T10022,2024-01-19 11:05,2024-01-19 12:30,Feature Request,Reporting,Low,Resolved,Enterprise,CRM System,Custom report builder needed,1.4,0.4,4,John Martinez,Feature Noted,No,Yes,0
T10023,2024-01-19 13:40,2024-01-19 15:15,Account,Deactivation,Medium,Resolved,Consumer,Cloud Storage Pro,Want to cancel subscription,1.6,0.8,3,Marcus Brown,Account Deactivated,No,No,0
T10024,2024-01-19 15:25,2024-01-23 09:40,Technical,API Issues,Critical,Resolved,Enterprise,Analytics Suite,API rate limiting too aggressive,90.3,0.2,3,Sarah Kim,Rate Limit Adjusted,Yes,Yes,5
T10025,2024-01-19 16:50,2024-01-19 17:35,How-To,Setup,Low,Resolved,Small Business,Security Suite,Initial setup guidance needed,0.8,0.3,5,David Lopez,Setup Call Scheduled,No,No,0
T10026,2024-01-20 08:45,2024-01-20 14:20,Technical,Sync Issues,Medium,Resolved,Enterprise,Collaboration Tools,Files not syncing across devices,5.6,0.6,4,Emily Chen,Sync Reset,No,No,0
T10027,2024-01-20 10:30,2024-01-20 11:45,Billing,Trial Extension,Low,Resolved,Small Business,Project Manager,Request trial extension,1.3,0.5,5,John Martinez,Trial Extended,No,No,0
T10028,2024-01-20 12:15,2024-01-24 10:30,Technical,Performance,High,Resolved,Enterprise,Database Pro,Slow query performance,94.3,0.4,3,Marcus Brown,Index Optimization,Yes,Yes,2
T10029,2024-01-20 14:45,2024-01-20 16:10,Account,Team Management,Medium,Resolved,Small Business,Marketing Automation,Remove user from team,1.4,0.7,5,Sarah Kim,User Removed,No,No,0
T10030,2024-01-20 16:30,2024-01-20 17:50,Feature Request,Mobile Features,Low,Resolved,Consumer,Email Platform,Offline mode for mobile app,1.3,0.4,4,David Lopez,Feature Request Logged,No,Yes,0`;

                Papa.parse(csvData, {
                    header: true,
                    dynamicTyping: true,
                    complete: (results) => {
                        setData(results.data);
                        setLoading(false);
                    }
                });
            };

            const getFilteredData = () => {
                return data.filter(ticket => {
                    const categoryMatch = filterCategory === 'all' || ticket.Category === filterCategory;
                    const priorityMatch = filterPriority === 'all' || ticket.Priority === filterPriority;
                    return categoryMatch && priorityMatch;
                });
            };

            const createCharts = () => {
                const filteredData = getFilteredData();

                // Ticket Volume by Product
                const productTickets = {};
                filteredData.forEach(ticket => {
                    productTickets[ticket.Product] = (productTickets[ticket.Product] || 0) + 1;
                });

                const sortedProducts = Object.entries(productTickets)
                    .sort((a, b) => b[1] - a[1]);

                if (chartInstances.current.ticketsByProduct) {
                    chartInstances.current.ticketsByProduct.destroy();
                }

                chartInstances.current.ticketsByProduct = new Chart(ticketsByProductRef.current, {
                    type: 'bar',
                    data: {
                        labels: sortedProducts.map(p => p[0]),
                        datasets: [{
                            label: 'Number of Tickets',
                            data: sortedProducts.map(p => p[1]),
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });

                // Satisfaction by Product
                const productSatisfaction = {};
                filteredData.forEach(ticket => {
                    if (!productSatisfaction[ticket.Product]) {
                        productSatisfaction[ticket.Product] = { total: 0, count: 0 };
                    }
                    productSatisfaction[ticket.Product].total += ticket.Customer_Satisfaction;
                    productSatisfaction[ticket.Product].count += 1;
                });

                const avgSatisfaction = Object.entries(productSatisfaction)
                    .map(([product, data]) => ({
                        product,
                        avg: data.total / data.count
                    }))
                    .sort((a, b) => a.avg - b.avg);

                if (chartInstances.current.satisfactionByProduct) {
                    chartInstances.current.satisfactionByProduct.destroy();
                }

                chartInstances.current.satisfactionByProduct = new Chart(satisfactionByProductRef.current, {
                    type: 'bar',
                    data: {
                        labels: avgSatisfaction.map(p => p.product),
                        datasets: [{
                            label: 'Avg Satisfaction Score',
                            data: avgSatisfaction.map(p => p.avg),
                            backgroundColor: avgSatisfaction.map(p =>
                                p.avg < 3.5 ? 'rgba(252, 129, 129, 0.8)' :
                                p.avg < 4.0 ? 'rgba(246, 173, 85, 0.8)' :
                                'rgba(104, 211, 145, 0.8)'
                            ),
                            borderColor: avgSatisfaction.map(p =>
                                p.avg < 3.5 ? 'rgba(252, 129, 129, 1)' :
                                p.avg < 4.0 ? 'rgba(246, 173, 85, 1)' :
                                'rgba(104, 211, 145, 1)'
                            ),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                ticks: { stepSize: 0.5 }
                            }
                        }
                    }
                });

                // Category Breakdown
                const categoryCount = {};
                filteredData.forEach(ticket => {
                    categoryCount[ticket.Category] = (categoryCount[ticket.Category] || 0) + 1;
                });

                if (chartInstances.current.categoryBreakdown) {
                    chartInstances.current.categoryBreakdown.destroy();
                }

                chartInstances.current.categoryBreakdown = new Chart(categoryBreakdownRef.current, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categoryCount),
                        datasets: [{
                            data: Object.values(categoryCount),
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(118, 75, 162, 0.8)',
                                'rgba(237, 137, 54, 0.8)',
                                'rgba(52, 211, 153, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 15, font: { size: 12 } }
                            }
                        }
                    }
                });

                // Priority Distribution
                const priorityCount = {};
                filteredData.forEach(ticket => {
                    priorityCount[ticket.Priority] = (priorityCount[ticket.Priority] || 0) + 1;
                });

                const priorityOrder = ['Low', 'Medium', 'High', 'Critical'];
                const orderedPriorities = priorityOrder.filter(p => priorityCount[p]);

                if (chartInstances.current.priorityDistribution) {
                    chartInstances.current.priorityDistribution.destroy();
                }

                chartInstances.current.priorityDistribution = new Chart(priorityDistributionRef.current, {
                    type: 'pie',
                    data: {
                        labels: orderedPriorities,
                        datasets: [{
                            data: orderedPriorities.map(p => priorityCount[p]),
                            backgroundColor: [
                                'rgba(104, 211, 145, 0.8)',
                                'rgba(246, 173, 85, 0.8)',
                                'rgba(251, 146, 60, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 15, font: { size: 12 } }
                            }
                        }
                    }
                });

                // Resolution Time by Product
                const productResolutionTime = {};
                filteredData.forEach(ticket => {
                    if (!productResolutionTime[ticket.Product]) {
                        productResolutionTime[ticket.Product] = { total: 0, count: 0 };
                    }
                    productResolutionTime[ticket.Product].total += ticket.Resolution_Time_Hours;
                    productResolutionTime[ticket.Product].count += 1;
                });

                const avgResolutionTime = Object.entries(productResolutionTime)
                    .map(([product, data]) => ({
                        product,
                        avg: data.total / data.count
                    }))
                    .sort((a, b) => b.avg - a.avg);

                if (chartInstances.current.resolutionTime) {
                    chartInstances.current.resolutionTime.destroy();
                }

                chartInstances.current.resolutionTime = new Chart(resolutionTimeRef.current, {
                    type: 'bar',
                    data: {
                        labels: avgResolutionTime.map(p => p.product),
                        datasets: [{
                            label: 'Avg Resolution Time (hours)',
                            data: avgResolutionTime.map(p => p.avg),
                            backgroundColor: 'rgba(237, 137, 54, 0.8)',
                            borderColor: 'rgba(237, 137, 54, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            x: { beginAtZero: true }
                        }
                    }
                });

                // Satisfaction vs Resolution Time Correlation
                const correlationData = Object.keys(productSatisfaction).map(product => {
                    const avgSat = productSatisfaction[product].total / productSatisfaction[product].count;
                    const avgResTime = productResolutionTime[product].total / productResolutionTime[product].count;
                    return {
                        x: avgResTime,
                        y: avgSat,
                        label: product
                    };
                });

                if (chartInstances.current.satisfactionTrend) {
                    chartInstances.current.satisfactionTrend.destroy();
                }

                chartInstances.current.satisfactionTrend = new Chart(satisfactionTrendRef.current, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Products',
                            data: correlationData,
                            backgroundColor: 'rgba(102, 126, 234, 0.6)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2,
                            pointRadius: 8,
                            pointHoverRadius: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (context) => {
                                        const point = correlationData[context.dataIndex];
                                        return `${point.label}: ${point.y.toFixed(2)} satisfaction, ${point.x.toFixed(1)}h resolution`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'Avg Resolution Time (hours)' },
                                beginAtZero: true
                            },
                            y: {
                                title: { display: true, text: 'Avg Customer Satisfaction' },
                                min: 0,
                                max: 5
                            }
                        }
                    }
                });
            };

            const calculateStats = () => {
                const filteredData = getFilteredData();

                const totalTickets = filteredData.length;
                const avgSatisfaction = filteredData.reduce((sum, t) => sum + t.Customer_Satisfaction, 0) / totalTickets;
                const avgResolutionTime = filteredData.reduce((sum, t) => sum + t.Resolution_Time_Hours, 0) / totalTickets;
                const escalatedCount = filteredData.filter(t => t.Escalated === 'Yes').length;
                const criticalCount = filteredData.filter(t => t.Priority === 'Critical').length;

                return {
                    totalTickets,
                    avgSatisfaction: avgSatisfaction.toFixed(2),
                    avgResolutionTime: avgResolutionTime.toFixed(1),
                    escalationRate: ((escalatedCount / totalTickets) * 100).toFixed(1),
                    criticalTickets: criticalCount
                };
            };

            const identifyProblemProducts = () => {
                const filteredData = getFilteredData();
                const productStats = {};

                filteredData.forEach(ticket => {
                    if (!productStats[ticket.Product]) {
                        productStats[ticket.Product] = {
                            tickets: 0,
                            totalSatisfaction: 0,
                            totalResolutionTime: 0,
                            escalated: 0,
                            critical: 0,
                            categories: {}
                        };
                    }

                    const stats = productStats[ticket.Product];
                    stats.tickets++;
                    stats.totalSatisfaction += ticket.Customer_Satisfaction;
                    stats.totalResolutionTime += ticket.Resolution_Time_Hours;
                    if (ticket.Escalated === 'Yes') stats.escalated++;
                    if (ticket.Priority === 'Critical') stats.critical++;
                    stats.categories[ticket.Sub_Category] = (stats.categories[ticket.Sub_Category] || 0) + 1;
                });

                const problems = Object.entries(productStats).map(([product, stats]) => {
                    const avgSat = stats.totalSatisfaction / stats.tickets;
                    const avgResTime = stats.totalResolutionTime / stats.tickets;
                    const escalationRate = (stats.escalated / stats.tickets) * 100;

                    let severity = 'monitor';
                    let score = 0;

                    if (avgSat < 3.5) score += 3;
                    else if (avgSat < 4.0) score += 2;
                    else if (avgSat < 4.5) score += 1;

                    if (stats.tickets >= 4) score += 2;
                    else if (stats.tickets >= 3) score += 1;

                    if (avgResTime > 60) score += 2;
                    else if (avgResTime > 30) score += 1;

                    if (escalationRate > 50) score += 2;
                    else if (escalationRate > 25) score += 1;

                    if (score >= 5) severity = 'critical';
                    else if (score >= 3) severity = 'warning';

                    return {
                        product,
                        avgSat,
                        avgResTime,
                        tickets: stats.tickets,
                        escalationRate,
                        critical: stats.critical,
                        severity,
                        score,
                        topIssues: Object.entries(stats.categories)
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 3)
                            .map(([cat, count]) => `${cat} (${count})`)
                    };
                }).sort((a, b) => b.score - a.score);

                return problems;
            };

            if (loading) {
                return <div className="loading">Loading support ticket data...</div>;
            }

            const stats = calculateStats();
            const problemProducts = identifyProblemProducts();
            const categories = [...new Set(data.map(t => t.Category))];
            const priorities = ['Low', 'Medium', 'High', 'Critical'];

            return (
                <div className="container">
                    <div className="header">
                        <h1>Support Ticket Analysis Dashboard</h1>
                        <p>Analyzing ticket patterns and customer satisfaction to identify problem products</p>
                    </div>

                    <div className="filters">
                        <div className="filter-group">
                            <span className="filter-label">Filter by:</span>
                            <select value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}>
                                <option value="all">All Categories</option>
                                {categories.map(cat => (
                                    <option key={cat} value={cat}>{cat}</option>
                                ))}
                            </select>
                            <select value={filterPriority} onChange={(e) => setFilterPriority(e.target.value)}>
                                <option value="all">All Priorities</option>
                                {priorities.map(pri => (
                                    <option key={pri} value={pri}>{pri}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">Total Tickets</div>
                            <div className="stat-value">{stats.totalTickets}</div>
                            <div className="stat-subtitle">Support requests analyzed</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Avg Satisfaction</div>
                            <div className="stat-value">{stats.avgSatisfaction}</div>
                            <div className="stat-subtitle">Out of 5.0</div>
                            {parseFloat(stats.avgSatisfaction) < 4.0 && (
                                <span className="alert-badge">Needs Attention</span>
                            )}
                            {parseFloat(stats.avgSatisfaction) >= 4.5 && (
                                <span className="success-badge">Excellent</span>
                            )}
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Avg Resolution Time</div>
                            <div className="stat-value">{stats.avgResolutionTime}h</div>
                            <div className="stat-subtitle">Average hours to resolve</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Escalation Rate</div>
                            <div className="stat-value">{stats.escalationRate}%</div>
                            <div className="stat-subtitle">Tickets escalated</div>
                            {parseFloat(stats.escalationRate) > 25 && (
                                <span className="alert-badge">High Rate</span>
                            )}
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Critical Tickets</div>
                            <div className="stat-value">{stats.criticalTickets}</div>
                            <div className="stat-subtitle">Highest priority issues</div>
                            {stats.criticalTickets > 3 && (
                                <span className="alert-badge">Action Required</span>
                            )}
                        </div>
                    </div>

                    <div className="problem-products">
                        <h2>
                            <span className="warning-icon">⚠️</span>
                            Problem Products Identified
                        </h2>
                        <div className="product-list">
                            {problemProducts.filter(p => p.severity !== 'monitor' || p.score > 0).map(product => (
                                <div key={product.product} className={`product-item ${product.severity}`}>
                                    <div className="product-header">
                                        <div className="product-name">{product.product}</div>
                                        <span className={`severity-badge severity-${product.severity}`}>
                                            {product.severity === 'critical' ? 'Critical' :
                                             product.severity === 'warning' ? 'Warning' : 'Monitor'}
                                        </span>
                                    </div>
                                    <div className="product-metrics">
                                        <div className="metric">
                                            <div className="metric-label">Avg Satisfaction</div>
                                            <div className={`metric-value ${
                                                product.avgSat < 3.5 ? 'bad' :
                                                product.avgSat < 4.0 ? 'warning' : 'good'
                                            }`}>
                                                {product.avgSat.toFixed(2)}
                                            </div>
                                        </div>
                                        <div className="metric">
                                            <div className="metric-label">Total Tickets</div>
                                            <div className="metric-value">{product.tickets}</div>
                                        </div>
                                        <div className="metric">
                                            <div className="metric-label">Avg Resolution</div>
                                            <div className={`metric-value ${
                                                product.avgResTime > 60 ? 'bad' :
                                                product.avgResTime > 30 ? 'warning' : 'good'
                                            }`}>
                                                {product.avgResTime.toFixed(1)}h
                                            </div>
                                        </div>
                                        <div className="metric">
                                            <div className="metric-label">Escalation Rate</div>
                                            <div className={`metric-value ${
                                                product.escalationRate > 50 ? 'bad' :
                                                product.escalationRate > 25 ? 'warning' : 'good'
                                            }`}>
                                                {product.escalationRate.toFixed(0)}%
                                            </div>
                                        </div>
                                    </div>
                                    {product.topIssues.length > 0 && (
                                        <div className="issues-list">
                                            <div className="issues-title">Top Issues:</div>
                                            {product.topIssues.map(issue => (
                                                <span key={issue} className="issue-tag">{issue}</span>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="charts-grid">
                        <div className="chart-card">
                            <h3 className="chart-title">Ticket Volume by Product</h3>
                            <div className="chart-container">
                                <canvas ref={ticketsByProductRef}></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <h3 className="chart-title">Customer Satisfaction by Product</h3>
                            <div className="chart-container">
                                <canvas ref={satisfactionByProductRef}></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <h3 className="chart-title">Ticket Categories Breakdown</h3>
                            <div className="chart-container">
                                <canvas ref={categoryBreakdownRef}></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <h3 className="chart-title">Priority Distribution</h3>
                            <div className="chart-container">
                                <canvas ref={priorityDistributionRef}></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <h3 className="chart-title">Avg Resolution Time by Product</h3>
                            <div className="chart-container">
                                <canvas ref={resolutionTimeRef}></canvas>
                            </div>
                        </div>

                        <div className="chart-card">
                            <h3 className="chart-title">Correlation: Resolution Time vs Satisfaction</h3>
                            <div className="chart-container">
                                <canvas ref={satisfactionTrendRef}></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>